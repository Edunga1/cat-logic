{"componentChunkName":"component---src-components-gatsby-templates-wiki-tsx","path":"/wiki/docker/","result":{"data":{"markdownRemark":{"headings":[{"value":"Docker"}],"fields":{"slug":"/docker/","relatedDocs":[{"slug":"javascript","similarity":0.6715430413},{"slug":"web","similarity":0.5760679031},{"slug":"2016-08-27-gdg-webtech-workshop-nnn","similarity":0.5457848046},{"slug":"crontab","similarity":0.5168129557},{"slug":"idea-methodology","similarity":0.3552542306},{"slug":"2016-11-16-google-campus-two-things-you-must-keep-in-google-play","similarity":0.4262611696},{"slug":"spring-framework","similarity":0.4627050119},{"slug":"aws","similarity":0.5094388313},{"slug":"git","similarity":0.4887337952},{"slug":"algorithm-practice","similarity":0.3277130652},{"slug":"docker","similarity":1},{"slug":"scp","similarity":0.3156677123},{"slug":"mac-os","similarity":0.5414729485},{"slug":"testing","similarity":0.4714817794},{"slug":"machine-learning","similarity":0.526780895},{"slug":"devops","similarity":0.3684774363},{"slug":"python","similarity":0.4871376069},{"slug":"object-oriented-programming","similarity":0.406480351},{"slug":"linux","similarity":0.3314360358},{"slug":"sfml","similarity":0.4476742511},{"slug":"windows","similarity":0.4539582753},{"slug":"markdown","similarity":0.3762262421},{"slug":"cat-logic","similarity":0.4168470021},{"slug":"vuejs","similarity":0.2472242427},{"slug":"shell","similarity":0.5512873553},{"slug":"html","similarity":0.3416511417},{"slug":"vimenter-2023","similarity":0.4238219996},{"slug":"data-analysis","similarity":0.3965839347},{"slug":"hardware","similarity":0.3311254212},{"slug":"programming-convention","similarity":0.420327673},{"slug":"webgl","similarity":0.447733897},{"slug":"sentry","similarity":0.2846151829},{"slug":"valve","similarity":0.261951824},{"slug":"reactjs","similarity":0.4332988459},{"slug":"airflow","similarity":0.4543536677},{"slug":"computer-graphics","similarity":0.2920891953},{"slug":"programming-philosophy","similarity":0.4072929929},{"slug":"elasticsearch","similarity":0.3988236091},{"slug":"unicode","similarity":0.338911051},{"slug":"logging","similarity":0.2893451609},{"slug":"tools","similarity":0.5251523661},{"slug":"programming-paradigm","similarity":0.4189224337},{"slug":"system-failures","similarity":0.3797878624},{"slug":"amazon-redshift","similarity":0.2868635753},{"slug":"inspiration","similarity":0.3060376299},{"slug":"gatsbyjs","similarity":0.5761279207},{"slug":"design-pattern","similarity":0.4349758047},{"slug":"game","similarity":0.3921781702},{"slug":"kubernetes","similarity":0.5584949162},{"slug":"llm-tools","similarity":0.6131771139},{"slug":"nodejs","similarity":0.5851287901},{"slug":"continuous-integration-and-deployment","similarity":0.3425538627},{"slug":"rust","similarity":0.3865588721},{"slug":"book","similarity":0.2826379623},{"slug":"jetbrains","similarity":0.5230671159},{"slug":"quotation","similarity":0.2793071582},{"slug":"postgresql","similarity":0.4368027182},{"slug":"jira","similarity":0.3079513927},{"slug":"swagger","similarity":0.3242996216},{"slug":"architecture","similarity":0.4787964849},{"slug":"unity3d","similarity":0.4671778173},{"slug":"jargon","similarity":0.3942602071},{"slug":"language-server-protocol","similarity":0.2929687781},{"slug":"clean-code","similarity":0.2984418506},{"slug":"java","similarity":0.4642626296},{"slug":"windows-subsystem-for-linux","similarity":0.6761357873},{"slug":"test-driven-development","similarity":0.231793731},{"slug":"github","similarity":0.5163536127},{"slug":"network","similarity":0.351345009},{"slug":"kotlin","similarity":0.4399428861},{"slug":"c-sharp","similarity":0.2654952952},{"slug":"angularjs","similarity":0.3951758393},{"slug":"vim","similarity":0.4501159178},{"slug":"ionic-framework","similarity":0.409782118},{"slug":"physics","similarity":0.4023280547},{"slug":"html-canvas","similarity":0.3595459081},{"slug":"reverse-engineering","similarity":0.290534382},{"slug":"space","similarity":0.3613307199},{"slug":"css","similarity":0.3926207409},{"slug":"code-review","similarity":0.3391285619},{"slug":"software-development","similarity":0.4062742382},{"slug":"database","similarity":0.5238323482},{"slug":"reactive-extensions","similarity":0.2089113733},{"slug":"redis","similarity":0.2932680997},{"slug":"mail","similarity":0.2405206736},{"slug":"experience-review","similarity":0.3361445454},{"slug":"google-analytics","similarity":0.2938955183},{"slug":"data-structure","similarity":0.3177259251},{"slug":"vimwiki","similarity":0.4222219894},{"slug":"embeddings","similarity":0.4245438938},{"slug":"추론 애플리케이션","similarity":0.418875596}]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#docker\">Docker</a></p>\n<ul>\n<li>\n<p><a href=\"#docker-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0\">Docker 환경 구성하기</a></p>\n<ul>\n<li>\n<p><a href=\"#docker-desktop\">Docker Desktop</a></p>\n</li>\n<li>\n<p><a href=\"#rancher-desktop\">Rancher Desktop</a></p>\n</li>\n<li>\n<p><a href=\"#colima\">Colima</a></p>\n<ul>\n<li><a href=\"#%EB%B0%94%EC%9D%B8%EB%94%A9%ED%95%9C-%ED%8F%AC%ED%8A%B8%EB%A1%9C-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A0%91%EA%B7%BC%EC%9D%B4-%EC%95%88%EB%90%98%EB%8A%94-%EB%AC%B8%EC%A0%9C\">바인딩한 포트로 컨테이너의 네트워크 접근이 안되는 문제</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#osx-%EC%97%90%EC%84%9C-%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-docker-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0\">OSX 에서 수동으로 Docker 환경 구성하기</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#dockerfile%EC%9D%98-volume-%EB%AA%85%EB%A0%B9%EC%96%B4\">Dockerfile의 Volume 명령어</a></p>\n</li>\n<li>\n<p><a href=\"#dockerfile\">Dockerfile</a></p>\n<ul>\n<li><a href=\"#%EB%AA%85%EB%A0%B9%EC%96%B4\">명령어</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A4%91%EC%A7%80%EB%90%9C-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%97%90%EC%84%9C-%ED%8C%8C%EC%9D%BC-%EB%B3%B5%EC%82%AC%ED%95%98%EA%B8%B0\">중지된 도커 컨테이너에서 파일 복사하기</a></p>\n</li>\n<li>\n<p><a href=\"#hostdockerinternal%EB%A1%9C-%ED%98%B8%EC%8A%A4%ED%8A%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%A0%91%EA%B7%BC%ED%95%98%EA%B8%B0\"><code class=\"language-text\">host.docker.internal</code>로 호스트 서비스 접근하기</a></p>\n<ul>\n<li><a href=\"#%EB%8C%80%EC%B2%B4%EB%8A%94\">대체는?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#troubleshooting\">Troubleshooting</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%A7%A5%EB%B6%81-m2-%EC%9D%B4%EC%8A%88\">맥북 m2 이슈</a></p>\n<ul>\n<li><a href=\"#mysql56\">mysql:5.6</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#wsl2%EC%97%90%EC%84%9C-nvidia-gpu-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-%ED%95%B4%EA%B2%B0%EC%A4%91\">WSL2에서 Nvidia GPU 사용하기 (해결중...)</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#references\">References</a></p>\n</li>\n</ul>\n</li>\n</ul>","html":"<h1 id=\"docker\" style=\"position:relative;\"><a href=\"#docker\" aria-label=\"docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker</h1>\n<h2 id=\"docker-환경-구성하기\" style=\"position:relative;\"><a href=\"#docker-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"docker 환경 구성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker 환경 구성하기</h2>\n<p>여러가지 선택지가 있으나 MacOS, Linux라면 Colima를 가장 추천한다.\nWSL2는 Rancher Desktop 추천.</p>\n<h3 id=\"docker-desktop\" style=\"position:relative;\"><a href=\"#docker-desktop\" aria-label=\"docker desktop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Desktop</h3>\n<p><a href=\"https://www.docker.com/products/docker-desktop/\">https://www.docker.com/products/docker-desktop/</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> <span class=\"token parameter variable\">--cask</span> <span class=\"token function\">docker</span></code></pre></div>\n<p>가장 쉽게 Docker를 사용할 수 있는 방법이다.\n개인 사용자는 무료로 사용할 수 있다.\n라이센스 정책 변경으로 인해 <a href=\"https://www.docker.com/pricing/faq/\">기업 사용자는 조건</a>에 따라 유료로 사용해야 한다.</p>\n<h3 id=\"rancher-desktop\" style=\"position:relative;\"><a href=\"#rancher-desktop\" aria-label=\"rancher desktop permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rancher Desktop</h3>\n<p><a href=\"https://rancherdesktop.io/\">https://rancherdesktop.io/</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> <span class=\"token parameter variable\">--cask</span> rancher</code></pre></div>\n<p>Docker Desktop과 흡사하다. 기본적으로 <a href=\"../kubernetes\">k8s</a> 제공한다.\n불필요 하다면 끄는 편이 리소스 절약에 좋다.\ncontainer runtime을 containerd, dockerd 중 선택할 수 있는데, docker에 익숙하면 dockerd를 선택하는 것이 좋다.</p>\n<p>개인 사용자더라도 docker desktop의 라이센스 정책이 불편하니 그냥 rancher desktop을 사용하는 것이 좋을지도.</p>\n<p>WSL2을 잘 지원한다.</p>\n<p><code class=\"language-text\">rdctl</code> 명령어를 제공한다.</p>\n<p>다음과 같이 시작할 수 있다: <code class=\"language-text\">rdctl start --path /mnt/c/Program\\ Files/Rancher\\ Desktop/Rancher\\ Desktop.exe</code></p>\n<p><code class=\"language-text\">--path</code> 옵션이 필수는 아닌 거 같지만, 내 경우는 찾지 못했다. 그래서 실행 파일로 시작하는 것과 비교해서 별다른 장정이 없다.</p>\n<p>종료는 그래도 편할 수도 있겠다: <code class=\"language-text\">rdctl shutdown</code></p>\n<h3 id=\"colima\" style=\"position:relative;\"><a href=\"#colima\" aria-label=\"colima permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Colima</h3>\n<p><a href=\"https://github.com/abiosoft/colima/\">https://github.com/abiosoft/colima/</a></p>\n<p>Linux, MacOS 모두 지원한다.\n최소한의 설정으로 컨테이너를 제공한다고 설명한다:</p>\n<blockquote>\n<p>Container runtimes on macOS (and Linux) with minimal setup</p>\n</blockquote>\n<p>MacOs는 homebrew로 쉽게 설치할 수 있다: <code class=\"language-text\">brew install colima</code></p>\n<p><a href=\"https://github.com/abiosoft/colima/issues/434\">아직 WSL2를 지원하지 않으니</a> 주의.\n<a href=\"https://github.com/lima-vm/\">Lima</a>라는 가상머신 지원 도구를 사용하는데, 아직 윈도우를 지원하지 않아서 colima도 제공할 수 없다는 듯. 조만간 WSL도 제공할 수 있을 거 같다고 하니 기다려 보자.</p>\n<p>Command line으로만 도커를 시작할 수 있다.\nGUI를 제공하지 않지만 Docker Desktop이나 Rancher Desktop에서도 GUI를 잘 사용하지 않으니 딱히 문제는 안된다.</p>\n<p><code class=\"language-text\">colima</code> 명령어를 제공하고, <code class=\"language-text\">colima start</code>로 도커를 시작한다.\n다만 기본으로 memory가 <code class=\"language-text\">2</code>GiB로 설정되는데, 메모리 문제로 <a href=\"https://github.com/marclamberti/docker-airflow/blob/main/docker-compose.yml\">airflow 컨테이너</a>가 시작하자마자 죽는 문제가 있었다.</p>\n<p><code class=\"language-text\">colima start --memory 8 --cpu 4</code>와 같이 자원 할당을 늘려서 시작할 수 있다.</p>\n<p>현재 자원 할당 상태를 보려면 <code class=\"language-text\">colima status -e</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ colima status <span class=\"token parameter variable\">-e</span>\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> colima is running using QEMU\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> arch: aarch64\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> runtime: <span class=\"token function\">docker</span>\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> mountType: sshfs\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> socket: unix:///Users/alleb/.colima/default/docker.sock\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> networkDriver: gvproxy\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> cpu: <span class=\"token number\">2</span>\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> mem: 8GiB\nINFO<span class=\"token punctuation\">[</span>0000<span class=\"token punctuation\">]</span> disk: 60GiB</code></pre></div>\n<h4 id=\"바인딩한-포트로-컨테이너의-네트워크-접근이-안되는-문제\" style=\"position:relative;\"><a href=\"#%EB%B0%94%EC%9D%B8%EB%94%A9%ED%95%9C-%ED%8F%AC%ED%8A%B8%EB%A1%9C-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A0%91%EA%B7%BC%EC%9D%B4-%EC%95%88%EB%90%98%EB%8A%94-%EB%AC%B8%EC%A0%9C\" aria-label=\"바인딩한 포트로 컨테이너의 네트워크 접근이 안되는 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>바인딩한 포트로 컨테이너의 네트워크 접근이 안되는 문제</h4>\n<p><code class=\"language-text\">docker ps</code>로 포트 바인딩을 확인되는데도, <code class=\"language-text\">localhost:포트</code>로 액세스할 수 없는 경우가 종종 발생한다.</p>\n<p>docker-desktop 등 다른 도구에서는 그런적이 없었던 거 같은데, colima 사용하면서, 재시작하지 않고 오래 사용하면 발생하는 거 같기도 하다.</p>\n<p>어쨌든 <code class=\"language-text\">colima stop</code>으로 중지하고 다시 <code class=\"language-text\">colima start</code>로 재시작하면 해결되었다. <code class=\"language-text\">colima restart</code>는 안되었다.</p>\n<p><a href=\"https://github.com/abiosoft/colima/issues/71#issuecomment-1048749674\">Colima 이슈</a>에 비슷한 내용으로 등록된 것도 있는데,\n내 경우는 colima를 시작하지 얼마 안된 경우에는 발생하지 않았다는 점에서 좀 다르다. 이슈어는 방금 시작한 후 포트가 활성화되지 않았다고 한다.<br>\n리액션이 가장 많은 답변은 <code class=\"language-text\">docker.sock</code>이 오래된 파일을 가르키고 있어서 발생했고, symlink를 새로 만들어서 해결했다고 한다.</p>\n<blockquote>\n<p>Solved it by removing the old symlink and then sudo ln -s /Users/$USER/.colima/docker.sock /var/run/docker.sock.</p>\n</blockquote>\n<h3 id=\"osx-에서-수동으로-docker-환경-구성하기\" style=\"position:relative;\"><a href=\"#osx-%EC%97%90%EC%84%9C-%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-docker-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"osx 에서 수동으로 docker 환경 구성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OSX 에서 수동으로 Docker 환경 구성하기</h3>\n<p><strong>docker desktop 또는 rancher desktop이 나와서 이 방법은 비추천.</strong></p>\n<p><strong>1. Homebrew로 Docker와 Docker-machine 설치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew <span class=\"token function\">install</span> <span class=\"token function\">docker</span> docker-machine</code></pre></div>\n<p>docker-machine: 맥을 마치 Host OS 처럼 사용 할 수 있도록 해주는 프로그램</p>\n<p><strong>2. Homebrew로 Virtualbox 설치</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew cask <span class=\"token function\">install</span> virtualbox</code></pre></div>\n<p>Virtualbox: 가상화 프로그램. 맥에서 docker-machine(Host OS, Linux)을 운영하기 위해서 사용</p>\n<p><strong>3. docker-machine 설정</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker-machine create <span class=\"token parameter variable\">-d</span> virtualbox default</code></pre></div>\n<p>virtualbox driver를 이용하여 <code class=\"language-text\">default</code> 이름의 Docker-machine을 생성</p>\n<p>virtualbox에 Docker-machine이 올라간다.</p>\n<p><strong>4. 생성한 Docker-machine 활성화</strong></p>\n<p>Docker-machine을 생성했지만, 아직 <code class=\"language-text\">docker</code> 명령어를 이용할 수 없다.</p>\n<p>Docker-machine을 여러개 관리할 수 있다. 따라서 사용하고자 하는 Docker-machine을 활성화해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker-machine <span class=\"token function\">ls</span>\nNAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS\ndefault   -        virtualbox   Running   tcp://192.168.99.100:2376           v17.03.0-ce\n\n$ docker-machine <span class=\"token function\">env</span> default\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_TLS_VERIFY</span><span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_HOST</span><span class=\"token operator\">=</span><span class=\"token string\">\"tcp://192.168.99.100:2376\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_CERT_PATH</span><span class=\"token operator\">=</span><span class=\"token string\">\"/Users/parkdu/.docker/machine/machines/default\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOCKER_MACHINE_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"default\"</span>\n<span class=\"token comment\">## Run this command to configure your shell:</span>\n<span class=\"token comment\">## eval $(docker-machine env default)</span></code></pre></div>\n<p>위 명령어로 <code class=\"language-text\">default</code> Docker-machine의 환경 정보를 알 수 있다.</p>\n<p>그리고 마지막 <code class=\"language-text\">eval</code> 명령어로 활성화 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">eval</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>docker-machine <span class=\"token function\">env</span> default<span class=\"token variable\">)</span></span>\n$ docker-machine <span class=\"token function\">ls</span>\nNAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS\ndefault   *        virtualbox   Running   tcp://192.168.99.100:2376           v17.03.0-ce</code></pre></div>\n<p>ACTIVE 속성이 <code class=\"language-text\">*</code>로 변경되었다.</p>\n<p>이제 맥에서 <code class=\"language-text\">docker</code> 명령어를 사용할 수 있다!</p>\n<h2 id=\"dockerfile의-volume-명령어\" style=\"position:relative;\"><a href=\"#dockerfile%EC%9D%98-volume-%EB%AA%85%EB%A0%B9%EC%96%B4\" aria-label=\"dockerfile의 volume 명령어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile의 Volume 명령어</h2>\n<p>다음과 같이 컨테이너를 띄우면 <code class=\"language-text\">docker run -ti --rm -v $(pwd):/myvol --name foo ubuntu</code>\n현재 디렉토리를 컨테이너와 공유하여 사용할 수 있다.</p>\n<p>그런데 <strong>Dockerfile</strong> 내에서 <code class=\"language-text\">VOLUME</code> 키워드를 사용하면 호스트를 지정해 줄 수 없다.</p>\n<p>그리고 호스트의 디렉토리를 생략하여 <code class=\"language-text\">-v</code> 옵션을 줄 수 있다: <code class=\"language-text\">docker run -ti --rm -v /myvol --name foo ubuntu</code></p>\n<p>이는 컨테이너의 경로만 지정한 것이 된다.</p>\n<p><code class=\"language-text\">docker inspect</code>로 보면 호스트의 디렉토리(<code class=\"language-text\">source</code>)는 이상한 곳에 연결되어 있다:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Mounts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"volume\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"922a144309641e2cb18e84498b6b3b5f7f55eacd8073b37062b1dc50cc568814\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/922a144309641e2cb18e84498b6b3b5f7f55eacd8073b37062b1dc50cc568814/_data\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/myvol\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Driver\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Mode\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"RW\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Propagation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>이건 어디다 어떻게 쓰는가?</p>\n<p><strong>컨테이너간 데이터 공유</strong> 위해서 사용한다.</p>\n<ol>\n<li><code class=\"language-text\">foo</code> 컨테이너를 띄운다:<br></li>\n</ol>\n<p><code class=\"language-text\">docker run -ti --rm -v /myvol --name foo ubuntu</code></p>\n<ol start=\"2\">\n<li>그리고 <code class=\"language-text\">foo</code> 컨테이너와 데이터를 함께 사용할 <code class=\"language-text\">bar</code>를 띄운다:<br></li>\n</ol>\n<p><code class=\"language-text\">docker run -ti --rm --volumes-from foo --name bar ubuntu</code></p>\n<ol start=\"3\">\n<li><code class=\"language-text\">foo</code>와 <code class=\"language-text\">bar</code> 내에서 볼륨 연결된 디렉토리가 비어있음을 확인한다:<br></li>\n</ol>\n<p><code class=\"language-text\">ls myvol</code></p>\n<ol start=\"4\">\n<li><code class=\"language-text\">foo</code>에서 <code class=\"language-text\">text</code> 라는 파일을 생성해본다:<br></li>\n</ol>\n<p><code class=\"language-text\">touch myvol/text</code></p>\n<ol start=\"5\">\n<li><code class=\"language-text\">bar</code>에도 <code class=\"language-text\">myvol/text</code> 라는 파일이 생성되었음을 확인한다:<br></li>\n</ol>\n<p><code class=\"language-text\">ls myvol</code></p>\n<p>즉, 호스트 디렉토리 연결 없이 볼륨을 사용한다면 <code class=\"language-text\">--volumes-from</code> 옵션을 사용하는 컨테이너가 있음을 의미한다.</p>\n<h2 id=\"dockerfile\" style=\"position:relative;\"><a href=\"#dockerfile\" aria-label=\"dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile</h2>\n<p>도커 이미지를 빌드하기 위한 명령어들을 모아놓은 파일.</p>\n<p>스크립트로 이루어져 있기 때문에 이미지를 관리하는 것보다 훨씬 비용이 적게 든다는 장점이 있다.</p>\n<p>각 명령어 마다 이전 이미지로부터 새로운 이미지를 생성한다.(Layer)</p>\n<h3 id=\"명령어\" style=\"position:relative;\"><a href=\"#%EB%AA%85%EB%A0%B9%EC%96%B4\" aria-label=\"명령어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>명령어</h3>\n<p><strong>CMD</strong></p>\n<p>컨테이너 시작 시 실행 할 명령어</p>\n<ul>\n<li><code class=\"language-text\">CMD &lt;command></code></li>\n<li><code class=\"language-text\">CMD [\"executable\",\"param1\",\"param2\"]</code></li>\n</ul>\n<p><strong>RUN</strong></p>\n<p>빌드 시 실행할 명령어, 일반적으로 이미지의 환경을 구성하는데 사용한다.</p>\n<ul>\n<li><code class=\"language-text\">RUN &lt;command></code></li>\n<li><code class=\"language-text\">RUN [\"executable\", \"param1\", \"param2\"]</code></li>\n<li><code class=\"language-text\">RUN apt-get install -y nodejs</code></li>\n</ul>\n<p><strong>ENV</strong></p>\n<p>환경 변수 설정. RUN, CMD 명령어 모두에서 영향을 받는다.</p>\n<ul>\n<li><code class=\"language-text\">ENV &lt;key> &lt;value></code></li>\n<li><code class=\"language-text\">ENV &lt;key>=&lt;value></code></li>\n</ul>\n<p><strong>WORKDIR</strong></p>\n<p>작업 디렉토리 설정. RUN, CMD 명령어의 실행 위치를 설정한다.</p>\n<ul>\n<li><code class=\"language-text\">WORKDIR &lt;path></code></li>\n</ul>\n<p><a href=\"https://docs.docker.com/engine/reference/builder/#add\">ADD</a> or <a href=\"https://docs.docker.com/engine/reference/builder/#copy\">COPY</a></p>\n<p>호스트의 파일을 이미지에 추가.</p>\n<ul>\n<li><code class=\"language-text\">ADD &lt;src> &lt;dest></code></li>\n<li><code class=\"language-text\">ADD &lt;git ref> &lt;dir></code> git 저장소에서 파일을 가져온다.</li>\n</ul>\n<p><a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy\">ADD와 COPY 차이점</a>:</p>\n<blockquote>\n<p>Although ADD and COPY are functionally similar, generally speaking, COPY is preferred. That’s because it’s more transparent than ADD. COPY only supports the basic copying of local files into the container, while ADD has some features (like local-only tar extraction and remote URL support) that are not immediately obvious. Consequently, the best use for ADD is local tar file auto-extraction into the image, as in ADD rootfs.tar.xz /.</p>\n</blockquote>\n<p>Best Practice 문서에서 설명하기를, 기능 자체는 비슷하나 일반적(파일 복사)으로 <code class=\"language-text\">COPY</code>를 선호한다. 더 명확하기 때문이다.\n<code class=\"language-text\">ADD</code>에는 추가 기능이 있는데, tar 파일 압축 해제나 원격 URL 지원, git 저장소를 추가할 수 있다.</p>\n<p><a href=\"https://docs.docker.com/engine/reference/builder/#expose\">EXPOSE</a></p>\n<blockquote>\n<p>The EXPOSE instruction does not actually publish the port. It functions as a type of documentation between the person who builds the image and the person who runs the container, about which ports are intended to be published.</p>\n</blockquote>\n<p><code class=\"language-text\">EXPOSE</code>는 포트를 실제로 열지 않는다. 이미지 빌드하는 사람과 컨테이너를 실행하는 사람 사이의 문서 역할을 한다.\n<code class=\"language-text\">-p</code> 옵션으로 포트를 열거나, docker-compose의 <code class=\"language-text\">ports</code>를 사용하여 포트를 열자.</p>\n<p><code class=\"language-text\">EXPOSE</code>를 주면, 컨테이너를 생성하여 <code class=\"language-text\">docker ps</code>로 컨테이너를 확인했을 때 <code class=\"language-text\">PORTS</code> 열에 포트 정보가 표시된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CONTAINER ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS                                                            NAMES\n9f8fa8cbf88c        grokzen/redis-cluster:latest   <span class=\"token string\">\"/docker-entrypoint.…\"</span>   <span class=\"token number\">27</span> minutes ago      Up <span class=\"token number\">27</span> minutes       <span class=\"token number\">5000</span>-5002/tcp, <span class=\"token number\">6379</span>/tcp, <span class=\"token number\">7001</span>-7007/tcp, <span class=\"token number\">0.0</span>.0.0:6379-<span class=\"token operator\">></span><span class=\"token number\">7000</span>/tcp   redis-cluster</code></pre></div>\n<p>여기서 <code class=\"language-text\">5000-5002/tcp, 6379/tcp, 7001-7007/tcp</code>는 <code class=\"language-text\">EXPOSE</code>로 명세했지만 호스트와 바인딩되지 않았음을 의미한다.\n즉, <code class=\"language-text\">EXPOSE</code>는 포트 대기중을 의미한다.</p>\n<h2 id=\"중지된-도커-컨테이너에서-파일-복사하기\" style=\"position:relative;\"><a href=\"#%EC%A4%91%EC%A7%80%EB%90%9C-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%97%90%EC%84%9C-%ED%8C%8C%EC%9D%BC-%EB%B3%B5%EC%82%AC%ED%95%98%EA%B8%B0\" aria-label=\"중지된 도커 컨테이너에서 파일 복사하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>중지된 도커 컨테이너에서 파일 복사하기</h2>\n<p><code class=\"language-text\">docker ps -a</code>로 중지된 컨테이너가 있다면 그 컨테이너로부터 파일을 호스트로 복사해올 수 있다</p>\n<p><code class=\"language-text\">docker cp 컨테이너:경로 호스트경로</code>로 복사한다.<br>\n컨테이너와 호스트를 반대로 입력하여 중지된 컨테이너에 파일을 주입할 수도 있을 거 같다.</p>\n<p>반면 <code class=\"language-text\">docker exec</code>는 중지된 컨테이너에 접속할 수 없다.</p>\n<hr>\n<p>ionic으로 빌드를 하고, jarsginer로 서명까지하여 릴리즈 apk를 만드는 도커파일을 작성했다.<br>\n그리고 apk를 생성하면 컨테이너는 종료된다.<br>\n젠킨스에 등록하여 master 브랜치가 업데이트 될 때마다 apk를 뽑아서, GCP bucket에 업로드하도록 작성했다.<br></p>\n<p>처음엔 볼륨을 연결하여 호스트에 생성되도록 했으나 <code class=\"language-text\">mkdir /root/workspace: read-only file system.</code>에러가 뜬다.<br>\n젠킨스 slave의 문제인지. 어차피 볼륨으로 뿜어내는 방식이 내키지 않아서 다른 방식을 찾았다.<br>\n무한 루프를 돌도록해서 컨테이너가 죽지 않도록하여 복사해올까 하다가, 중지된 컨테이너에서 가져올 수 있었다.</p>\n<p>중지된 컨테이너가 다른 컨테이너에 볼륨을 공유하는 data-only 패턴과 비슷한 방식인듯?</p>\n<h2 id=\"hostdockerinternal로-호스트-서비스-접근하기\" style=\"position:relative;\"><a href=\"#hostdockerinternal%EB%A1%9C-%ED%98%B8%EC%8A%A4%ED%8A%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%A0%91%EA%B7%BC%ED%95%98%EA%B8%B0\" aria-label=\"hostdockerinternal로 호스트 서비스 접근하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">host.docker.internal</code>로 호스트 서비스 접근하기</h2>\n<p><code class=\"language-text\">host.docker.internal</code>은 호스트의 ip를 가르키는 DNS name이다.\n<a href=\"https://docs.docker.com/desktop/networking/#i-want-to-connect-from-a-container-to-a-service-on-the-host\">container에서 호스트의 서비스에 접근</a>이 필요할 때 사용한다.</p>\n<blockquote>\n<p>This is for development purpose and does not work in a production environment outside of Docker Desktop.</p>\n</blockquote>\n<p>주의할 점은 <strong>docker-desktop</strong> 에서 제공하는 것이다. rancher-desktop 등 다른 도구로 docker 구성했다면 사용할 수 없다.</p>\n<h3 id=\"대체는\" style=\"position:relative;\"><a href=\"#%EB%8C%80%EC%B2%B4%EB%8A%94\" aria-label=\"대체는 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>대체는?</h3>\n<p><code class=\"language-text\">docker</code> 명령어:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run --add-host<span class=\"token operator\">=</span>host.docker.internal:host-gateway</code></pre></div>\n<p><code class=\"language-text\">docker-compose.yml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">my_app</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"host.docker.internal:host-gateway\"</span></code></pre></div>\n<p>반드시 <code class=\"language-text\">host.docker.internal</code> 필요는 없다. 편한 것으로 수정하면 된다.</p>\n<p><code class=\"language-text\">host-gateway</code>의 정보는 잘 모르겠다. 가상화 도구 중 <code class=\"language-text\">dockerd</code>만 제공하는 것으로 보인다.</p>\n<p><code class=\"language-text\">dockerd</code> cli 문서만 있고, 간단하게 설명되어 있다:</p>\n<p><a href=\"https://docs.docker.com/engine/reference/commandline/dockerd/\">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p>\n<blockquote>\n<p>--host-gateway-ip ip\nIP address that the special 'host-gateway' string in --add-host resolves to.\nDefaults to the IP address of the default bridge</p>\n</blockquote>\n<h2 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h2>\n<h3 id=\"맥북-m2-이슈\" style=\"position:relative;\"><a href=\"#%EB%A7%A5%EB%B6%81-m2-%EC%9D%B4%EC%8A%88\" aria-label=\"맥북 m2 이슈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>맥북 m2 이슈</h3>\n<p>Intel CPU(amd64) -> M2(arm)로 옮기면서 발생한 문제</p>\n<h4 id=\"mysql56\" style=\"position:relative;\"><a href=\"#mysql56\" aria-label=\"mysql56 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mysql:5.6</h4>\n<p>mysql 8 버전 이하는 arm64 용으로<a href=\"https://hub.docker.com/r/arm64v8/mysql/\">제공하지 않는 것</a>으로 보인다.\n그래서 <code class=\"language-text\">docker pull mysql:5.6</code> 하면 manifest를 찾을 수 없다며 실패한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ <span class=\"token function\">docker</span> pull mysql:5.6\n<span class=\"token number\">5.6</span>: Pulling from library/mysql\nno matching manifest <span class=\"token keyword\">for</span> linux/arm64/v8 <span class=\"token keyword\">in</span> the manifest list entries</code></pre></div>\n<p>해결을 위해선 그냥 amd64 것을 사용해도 동작하므로 <code class=\"language-text\">--platform</code> 옵션을 줘서 amd64 것으로 받는다:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯ <span class=\"token function\">docker</span> pull <span class=\"token parameter variable\">--platform</span> linux/amd64 mysql:5.6</code></pre></div>\n<h3 id=\"wsl2에서-nvidia-gpu-사용하기-해결중\" style=\"position:relative;\"><a href=\"#wsl2%EC%97%90%EC%84%9C-nvidia-gpu-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-%ED%95%B4%EA%B2%B0%EC%A4%91\" aria-label=\"wsl2에서 nvidia gpu 사용하기 해결중 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WSL2에서 Nvidia GPU 사용하기 (해결중...)</h3>\n<p>Docker와 GPU 모두 잘 모르므로 일단 관련 정보만 좀 수집하자.</p>\n<p>해결하고자 하는 문제는 WSL2에서 GPU(Nvidia 사용중)를 사용하는 것이다.</p>\n<p>docker는 <code class=\"language-text\">--gpus</code> 옵션으로 GPU를 사용할 수 있다. 하지만 내 경우에는 다음과 같은 에러가 발생했다:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--gpus</span><span class=\"token operator\">=</span>all <span class=\"token parameter variable\">-v</span> ollama:/root/.ollama <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11434</span>:11434 <span class=\"token parameter variable\">--name</span> ollama ollama/ollama\nf94d6b2f2858892727c28c259e4d224b7f53414efa198d89e72bb06825cbeab6\ndocker: Error response from daemon: could not <span class=\"token keyword\">select</span> device driver <span class=\"token string\">\"\"</span> with capabilities: <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>gpu<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>.</code></pre></div>\n<p>ollama는 LLM을 사용하기 쉽게 해주는 도구. GPU로 향상된 성능을 이용하고 싶었다.</p>\n<hr>\n<p>Nvidia 공식 WSL2 지원 문서:<br>\n<a href=\"https://docs.nvidia.com/cuda/wsl-user-guide/index.html\">https://docs.nvidia.com/cuda/wsl-user-guide/index.html</a></p>\n<p>위 링크는 <a href=\"https://github.com/NVIDIA/nvidia-docker/issues/1034#issuecomment-703102098\">nvidia-docker 이슈</a>의 덧글에서 얻는 정보다.</p>\n<blockquote>\n<p>Note that NVIDIA Container Toolkit does not yet support Docker Desktop WSL 2 backend.</p>\n</blockquote>\n<p>2020년 10월에는 위 문구가 있었나 본데, 2024년 2월에는 해당 문구가 없어졌다. 지원하는 건가?</p>\n<hr>\n<p>GPU 지원 여부를 확인하려면:<br>\n<code class=\"language-text\">docker run -it --gpus=all --rm nvidia/cuda:11.4.2-base-ubuntu20.04 nvidia-smi</code></p>\n<p><a href=\"https://www.docker.com/blog/wsl-2-gpu-support-for-docker-desktop-on-nvidia-gpus/\">WSL 2 GPU Support for Docker Desktop on NVIDIA GPUs</a> 글에선 다음과 같이 응답한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--gpus</span><span class=\"token operator\">=</span>all <span class=\"token parameter variable\">--rm</span> nvidia/cuda:11.4.2-base-ubuntu20.04 nvidia-smi\nTue Dec  <span class=\"token number\">7</span> <span class=\"token number\">13</span>:25:19 <span class=\"token number\">2021</span>\n+-----------------------------------------------------------------------------+\n<span class=\"token operator\">|</span> NVIDIA-SMI <span class=\"token number\">510.00</span>       Driver Version: <span class=\"token number\">510.06</span>       CUDA Version: <span class=\"token number\">11.6</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>-------------------------------+----------------------+----------------------+\n<span class=\"token operator\">|</span> GPU  Name        Persistence-M<span class=\"token operator\">|</span> Bus-Id        Disp.A <span class=\"token operator\">|</span> Volatile Uncorr. ECC <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> Fan  Temp  Perf  Pwr:Usage/Cap<span class=\"token operator\">|</span>         Memory-Usage <span class=\"token operator\">|</span> GPU-Util  Compute M. <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                               <span class=\"token operator\">|</span>                      <span class=\"token operator\">|</span>               MIG M. <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">+=</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">0</span>  NVIDIA GeForce <span class=\"token punctuation\">..</span>.  On   <span class=\"token operator\">|</span> 00000000:01:00.0 Off <span class=\"token operator\">|</span>                  N/A <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> N/A    0C    P0    13W /  N/A <span class=\"token operator\">|</span>    132MiB /  4096MiB <span class=\"token operator\">|</span>     N/A      Default <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>                               <span class=\"token operator\">|</span>                      <span class=\"token operator\">|</span>                  N/A <span class=\"token operator\">|</span>\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n<span class=\"token operator\">|</span> Processes:                                                                  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  GPU   GI   CI        PID   Type   Process name                  GPU Memory <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>        ID   ID                                                   Usage      <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  No running processes found                                                 <span class=\"token operator\">|</span>\n+-----------------------------------------------------------------------------</code></pre></div>\n<p>반면에 나는 제대로된 응답을 받지 못한다:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--gpus</span><span class=\"token operator\">=</span>all <span class=\"token parameter variable\">--rm</span> nvidia/cuda:11.4.2-base-ubuntu20.04 nvidia-smi\nUnable to <span class=\"token function\">find</span> image <span class=\"token string\">'nvidia/cuda:11.4.2-base-ubuntu20.04'</span> locally\ndocker: Error response from daemon: manifest <span class=\"token keyword\">for</span> nvidia/cuda:11.4.2-base-ubuntu20.04 not found: manifest unknown: manifest unknown.\nSee <span class=\"token string\">'docker run --help'</span><span class=\"token builtin class-name\">.</span></code></pre></div>\n<h2 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h2>\n<p>NodeJS 어플리케이션의 Dockerizing<br>\n<a href=\"https://nodejs.org/en/docs/guides/nodejs-docker-webapp/\">https://nodejs.org/en/docs/guides/nodejs-docker-webapp/</a></p>\n<p>WSL 2 GPU Support for Docker Desktop on NVIDIA GPUs<br>\n<a href=\"https://www.docker.com/blog/wsl-2-gpu-support-for-docker-desktop-on-nvidia-gpus/\">https://www.docker.com/blog/wsl-2-gpu-support-for-docker-desktop-on-nvidia-gpus/</a></p>"}},"pageContext":{"id":"5e21a485-23ae-5561-9d9c-bd65b3da977c"}},"staticQueryHashes":[],"slicesMap":{}}