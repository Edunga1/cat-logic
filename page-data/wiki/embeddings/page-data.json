{"componentChunkName":"component---src-components-gatsby-templates-wiki-tsx","path":"/wiki/embeddings/","result":{"data":{"markdownRemark":{"headings":[{"value":"임베딩"}],"fields":{"relatedDocs":[]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%9E%84%EB%B2%A0%EB%94%A9\">임베딩</a></p>\n<ul>\n<li><a href=\"#cat-logic%EC%97%90-%EC%A0%81%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\">Cat Logic에 적용해보기</a></li>\n</ul>\n</li>\n</ul>","html":"<h1 id=\"임베딩\" style=\"position:relative;\"><a href=\"#%EC%9E%84%EB%B2%A0%EB%94%A9\" aria-label=\"임베딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>임베딩</h1>\n<p>임베딩은 콘텐츠를 벡터로 변환하는 것.</p>\n<p>예를들어 word2vec은 단어를 벡터로 변환한다.</p>\n<h2 id=\"cat-logic에-적용해보기\" style=\"position:relative;\"><a href=\"#cat-logic%EC%97%90-%EC%A0%81%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"cat logic에 적용해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cat Logic에 적용해보기</h2>\n<p><a href=\"https://news.hada.io/topic?id=11593\">임베딩(Embeddings)은 무엇이고 왜 중요한가</a> 글을 읽고 내 TIL 블로그도 똑같이 적용해보고 싶어졌다.</p>\n<p>필자는 Open AI의 임베딩 API를 사용해서 \"관련 글\"을 구현했다고 한다.\n블로그 글을 임베딩하여 결과를 SQLite에 저장하고 코사인 유사성을 계산했는데 그 비용이 매우 저렴해서 0.04 달러 밖에 들지 않았다고.\n필요할 때마다 변경된 글만 임베딩하면 되므로 유지 비용도 크게 들지 않을 것으로 보인다.\n다만, Open AI의 독점 모델을 사용했는데 모델이 종료되면서 변경해야 했단다.</p>\n<hr>\n<p>위에서 언급한 글에서는 Open AI의 <a href=\"https://platform.openai.com/docs/api-reference/embeddings\">text-embedding-ada-002</a> 모델을 사용했는데, 텍스트를 변환하는 모델이다.</p>\n<blockquote>\n<p>The input must not exceed the max input tokens for the model (8192 tokens for text-embedding-ada-002) and cannot be an empty string.</p>\n</blockquote>\n<p><code>text-embedding-ada-002</code>는 총 8192 tokens을 받을 수 있다. 단어나 구둣점 등이 토큰으로 취급되니 긴 글은 초과할 수도 있겠다.</p>\n<p>검색을 좀 해보니, 한글 성능도 괜찮다고 한다.\n오히려 무료 한글 모델이 성능이 부족하다고 하니 로컬에서 우선적으로 테스트하는 용도로 사용해 볼 듯.</p>\n<hr>\n<p>2023-11-02</p>\n<p><a href=\"https://github.com/SKTBrain/KoBERT\">KoBERT</a>를 시도해 보고있다.\n22년 이후로 관리되지 않아서인지 설치하는데 애먹고 있다.\n이슈 탭만 보더라도 많은 사람들이 설치에 어려움을 겪고 있다.\n파이썬 의존성 설치와 관련된 문제다. 아쉽게도 README에 환경에 대해서 잘 명세하지 않고 있다.\n포크 받아서 의존성 버전 수정하면 어떻게든 해볼 수 있을 듯.</p>\n<hr>\n<p>2023-11-05 <strong>임베딩을 직접 해봤다</strong>.</p>\n<p>KoBERT는 환경 구성이 번거로워서 포기했다.\n나중에 시간이 나면 해볼 생각이다.</p>\n<p>OpenAI의 <code>text-embedding-ada-002</code> 모델을 사용해 보았다.\n아쉽게도 ChatGPT를 예전부터 사용하고 있어서 무료 크레딧이 모두 만료되어 있었다. 총 $18 제공 했었는데.</p>\n<p><a href=\"../cat-logic\">Cat Logic</a> 문서를 임베딩 했고, Cosine 유사도를 계산해 보았다.\nOpenAI를 호출하고 csv로 저장하는 파이썬 코드와 임베딩 결과를 모두 Cat Logic 저장소에 올려두었다:<br>\n<a href=\"https://github.com/Edunga1/cat-logic/tree/main/embeddings\">https://github.com/Edunga1/cat-logic/tree/main/embeddings</a></p>\n<p>총 83개의 문서를 처리했다. 한 번에 8천개 토큰 만큼만 호출할 수 있다.\n그래서 문서를 토큰 기준으로 자를 필요가 있다. 문자열 길이로 자르면 토큰 수 계산이 일정하게 되지 않는다.</p>\n<p><a href=\"https://pypi.org/project/tiktoken/\">tiktoken</a>으로 토큰을 계산할 수 있다.</p>\n<p>한글은 단어당 토큰을 더 많이 사용한다. <code>orange</code>는 1토큰인 반면에 <code>귤</code>은 2토큰이다.\n단어를 토큰화하면 일련의 숫자 배열인 토큰으로 변한다. 이것을 인코딩이라 한다.\n배열 크기가 토큰 수가 된다. 다시 디코딩하면 토큰이 단어로 변한다.\n인코딩과 디코딩을 통해 텍스트를 토큰 기준으로 자를 수 있다.\n다만 한글은 1개의 글자가 2개 토큰이 되기도 하므로 경계가 잘리면 의미없는 값이 나올 수 있다.\n전체 문서중 아주 작은 부분일 것이므로 무시하기로 했다.</p>\n<p>어쨌든 임베딩하면 다차원 배열로 임베딩 결과가 나오게 되고,\n이걸 numpy로 읽어서, 코사인 유사도를 계산하면 된다.</p>\n<p>다음은 <a href=\"../javascript\">javascript.md</a> 문서와 다른 문서들의 유사도를 계산한 결과다:</p>\n<deckgo-highlight-code language=\"bash\"  >\n          <code slot=\"code\">                    filename_x                                         filename_y  similarity\n0   ../docs/wiki/javascript.md                         ../docs/wiki/javascript.md    1.000000\n46  ../docs/wiki/javascript.md                             ../docs/wiki/nodejs.md    0.882524\n66  ../docs/wiki/javascript.md                          ../docs/wiki/angularjs.md    0.868043\n32  ../docs/wiki/javascript.md                            ../docs/wiki/reactjs.md    0.860560\n1   ../docs/wiki/javascript.md                                ../docs/wiki/web.md    0.854540\n54  ../docs/wiki/javascript.md                       ../docs/wiki/architecture.md    0.852273\n2   ../docs/wiki/javascript.md  ../docs/wiki/2016-08-27-gdg-webtech-workshop-n...    0.849046\n58  ../docs/wiki/javascript.md                         ../docs/wiki/clean-code.md    0.848594\n29  ../docs/wiki/javascript.md                              ../docs/wiki/webgl.md    0.845717\n35  ../docs/wiki/javascript.md             ../docs/wiki/programming-philosophy.md    0.845219\n17  ../docs/wiki/javascript.md        ../docs/wiki/object-oriented-programming.md    0.842636\n40  ../docs/wiki/javascript.md               ../docs/wiki/programming-paradigm.md    0.841840\n74  ../docs/wiki/javascript.md               ../docs/wiki/software-development.md    0.841606\n42  ../docs/wiki/javascript.md                           ../docs/wiki/gatsbyjs.md    0.839241\n41  ../docs/wiki/javascript.md                        ../docs/wiki/inspiration.md    0.838280\n69  ../docs/wiki/javascript.md                            ../docs/wiki/physics.md    0.829791\n56  ../docs/wiki/javascript.md                             ../docs/wiki/jargon.md    0.828210\n79  ../docs/wiki/javascript.md                  ../docs/wiki/experience-review.md    0.826690\n14  ../docs/wiki/javascript.md                   ../docs/wiki/machine-learning.md    0.825359\n5   ../docs/wiki/javascript.md  ../docs/wiki/2016-11-16-google-campus-two-thin...    0.824535\n43  ../docs/wiki/javascript.md                     ../docs/wiki/design-pattern.md    0.823865\n50  ../docs/wiki/javascript.md                          ../docs/wiki/jetbrains.md    0.822214\n22  ../docs/wiki/javascript.md                          ../docs/wiki/cat-logic.md    0.820970\n73  ../docs/wiki/javascript.md                        ../docs/wiki/code-review.md    0.819712\n64  ../docs/wiki/javascript.md                             ../docs/wiki/kotlin.md    0.819240\n8   ../docs/wiki/javascript.md                                ../docs/wiki/git.md    0.818140\n25  ../docs/wiki/javascript.md                               ../docs/wiki/html.md    0.817782\n24  ../docs/wiki/javascript.md                              ../docs/wiki/shell.md    0.817766\n55  ../docs/wiki/javascript.md                            ../docs/wiki/unity3d.md    0.816814\n67  ../docs/wiki/javascript.md                                ../docs/wiki/vim.md    0.816136\n75  ../docs/wiki/javascript.md                           ../docs/wiki/database.md    0.814912\n61  ../docs/wiki/javascript.md            ../docs/wiki/test-driven-development.md    0.814854\n57  ../docs/wiki/javascript.md           ../docs/wiki/language-server-protocol.md    0.812373\n15  ../docs/wiki/javascript.md                             ../docs/wiki/devops.md    0.812291\n47  ../docs/wiki/javascript.md  ../docs/wiki/continuous-integration-and-deploy...    0.811741\n13  ../docs/wiki/javascript.md                            ../docs/wiki/testing.md    0.811093\n39  ../docs/wiki/javascript.md                              ../docs/wiki/tools.md    0.809628\n28  ../docs/wiki/javascript.md             ../docs/wiki/programming-convention.md    0.808528\n65  ../docs/wiki/javascript.md                            ../docs/wiki/c-sharp.md    0.808382\n6   ../docs/wiki/javascript.md                   ../docs/wiki/spring-framework.md    0.807617\n4   ../docs/wiki/javascript.md                   ../docs/wiki/idea-methodology.md    0.807293\n37  ../docs/wiki/javascript.md                            ../docs/wiki/unicode.md    0.806298\n68  ../docs/wiki/javascript.md                    ../docs/wiki/ionic-framework.md    0.806017\n72  ../docs/wiki/javascript.md                                ../docs/wiki/css.md    0.805362\n49  ../docs/wiki/javascript.md                               ../docs/wiki/book.md    0.804810\n82  ../docs/wiki/javascript.md                            ../docs/wiki/vimwiki.md    0.802841\n21  ../docs/wiki/javascript.md                           ../docs/wiki/markdown.md    0.801383\n23  ../docs/wiki/javascript.md                              ../docs/wiki/vuejs.md    0.800746\n81  ../docs/wiki/javascript.md                     ../docs/wiki/data-structure.md    0.794468\n16  ../docs/wiki/javascript.md                             ../docs/wiki/python.md    0.794347\n59  ../docs/wiki/javascript.md                               ../docs/wiki/java.md    0.793991\n18  ../docs/wiki/javascript.md                              ../docs/wiki/linux.md    0.793489\n10  ../docs/wiki/javascript.md                             ../docs/wiki/docker.md    0.793108\n19  ../docs/wiki/javascript.md                               ../docs/wiki/sfml.md    0.792960\n9   ../docs/wiki/javascript.md                 ../docs/wiki/algorithm-practice.md    0.792566\n44  ../docs/wiki/javascript.md                               ../docs/wiki/game.md    0.792278\n36  ../docs/wiki/javascript.md                      ../docs/wiki/elasticsearch.md    0.791766\n60  ../docs/wiki/javascript.md        ../docs/wiki/windows-subsystem-for-linux.md    0.791548\n80  ../docs/wiki/javascript.md                   ../docs/wiki/google-analytics.md    0.791235\n30  ../docs/wiki/javascript.md                             ../docs/wiki/sentry.md    0.790978\n12  ../docs/wiki/javascript.md                             ../docs/wiki/mac-os.md    0.789427\n20  ../docs/wiki/javascript.md                            ../docs/wiki/windows.md    0.789279\n7   ../docs/wiki/javascript.md                                ../docs/wiki/aws.md    0.788144\n53  ../docs/wiki/javascript.md                            ../docs/wiki/swagger.md    0.787858\n31  ../docs/wiki/javascript.md                              ../docs/wiki/valve.md    0.786964\n51  ../docs/wiki/javascript.md                          ../docs/wiki/quotation.md    0.786382\n38  ../docs/wiki/javascript.md                            ../docs/wiki/logging.md    0.785585\n45  ../docs/wiki/javascript.md                         ../docs/wiki/kubernetes.md    0.785464\n70  ../docs/wiki/javascript.md                        ../docs/wiki/html-canvas.md    0.782338\n26  ../docs/wiki/javascript.md                      ../docs/wiki/data-analysis.md    0.782211\n3   ../docs/wiki/javascript.md                            ../docs/wiki/crontab.md    0.777749\n52  ../docs/wiki/javascript.md                               ../docs/wiki/jira.md    0.777742\n63  ../docs/wiki/javascript.md                            ../docs/wiki/network.md    0.777385\n48  ../docs/wiki/javascript.md                               ../docs/wiki/rust.md    0.777058\n71  ../docs/wiki/javascript.md                ../docs/wiki/reverse-engineering.md    0.776867\n27  ../docs/wiki/javascript.md                           ../docs/wiki/hardware.md    0.774096\n62  ../docs/wiki/javascript.md                             ../docs/wiki/github.md    0.772994\n34  ../docs/wiki/javascript.md                  ../docs/wiki/computer-graphics.md    0.772767\n76  ../docs/wiki/javascript.md                ../docs/wiki/reactive-extensions.md    0.770802\n78  ../docs/wiki/javascript.md                               ../docs/wiki/mail.md    0.767006\n77  ../docs/wiki/javascript.md                              ../docs/wiki/redis.md    0.758210\n33  ../docs/wiki/javascript.md                            ../docs/wiki/airflow.md    0.753884</code>\n        </deckgo-highlight-code>\n<p>자기 자신과의 유사도는 1이다. 1에 가까울수록 유사도가 높다.<br>\n<code>javascript.md</code> 문서와 <code>nodejs.md</code> 문서가 가장 유사하다.<br>\n<code>javascript.md</code> 문서와 <code>redis.md</code> 문서가 가장 유사하지 않다.</p>\n<p>같은 자바스크립트 관련 문서인 <code>nodejs.md</code>, <code>reactjs.md</code>, <code>angularjs.md</code>는 유사도가 높다.\n납득이 가는 결과라 만족스럽다.</p>\n<p>임베딩 API를 사용하는데 총 0.03 달러가 소모되었다. 한국 돈으로 40원 정도다.\n<a href=\"https://wikidocs.net/200466\">wikidocs</a> 문서에 따르면 ada-002 모델로 어린 왕자 책 분량인 4만 토큰을 임베딩하는데 0.016 달러가 소모된다고 한다.</p>"}},"pageContext":{"id":"705361c5-df77-553a-8610-ee80911556ab"}},"staticQueryHashes":[],"slicesMap":{}}