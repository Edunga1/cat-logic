{"componentChunkName":"component---src-pages-wiki-markdown-remark-fields-slug-tsx","path":"/wiki/2023-07-05/","result":{"data":{"markdownRemark":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#elasticsearch-seminar\">Elasticsearch seminar</a></p>\n<ul>\n<li>\n<p><a href=\"#%EA%B2%80%EC%83%89\">검색</a></p>\n<ul>\n<li><a href=\"#generative-ai%EC%97%90%EC%84%9C-elasticsearch%EC%9D%98-%ED%8F%AC%EC%A7%80%EC%85%98\">Generative AI에서 Elasticsearch의 포지션.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#engine\">Engine</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#es-deep-dive\">ES Deep Dive</a></p>\n<ul>\n<li><a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8-%EB%B6%84%EC%84%9D\">텍스트 분석</a></li>\n<li><a href=\"#aggregation\">Aggregation</a></li>\n<li><a href=\"#%EC%83%89%EC%9D%B8\">색인</a></li>\n<li><a href=\"#lucene-segment%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%8A%B8\">Lucene Segment(세그먼트)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#whats-new-in-es-88\">What's new in ES 8.8</a></p>\n<ul>\n<li><a href=\"#logging\">Logging</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#\">..</a></p>\n</li>\n</ul>","html":"<h1 id=\"elasticsearch-seminar\" style=\"position:relative;\"><a href=\"#elasticsearch-seminar\" aria-label=\"elasticsearch seminar permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elasticsearch seminar</h1>\n<p>8.0 변경점\n검색 외에도 로깅 등 응용 시스템</p>\n<h2 id=\"검색\" style=\"position:relative;\"><a href=\"#%EA%B2%80%EC%83%89\" aria-label=\"검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>검색</h2>\n<p>키워드 검색에서 서술형 사용자 질의로 바뀌고 있음</p>\n<ul>\n<li>e.g. pvc plumbing irrigation systems</li>\n<li>e.g. 미시간 주 근처 ~할 수 있는...</li>\n<li>e.g. 이커머스 경우, ~동 근처 100m 내 xxx상품</li>\n<li>e.g. 인트라넷 문서 검색도 컨텍스트 기반으로.</li>\n</ul>\n<h3 id=\"generative-ai에서-elasticsearch의-포지션\" style=\"position:relative;\"><a href=\"#generative-ai%EC%97%90%EC%84%9C-elasticsearch%EC%9D%98-%ED%8F%AC%EC%A7%80%EC%85%98\" aria-label=\"generative ai에서 elasticsearch의 포지션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generative AI에서 Elasticsearch의 포지션.</h3>\n<p>데이터가 증가함에따라 기하급수적으로 늘어나는 비용을 ES가 해결할 수 있다.</p>\n<p>Chat GPT는 공개 데이터, 비즈니스에 맞게 개선하려면 private 데이터를 처리할 수 있어야 함.</p>\n<p>ES + GAI + Internal DATA\nES는 bridge 역할을 함</p>\n<p>e.g.\n사용자 질의를 ES에 먼저 던진다. 바로 AI 서비스에 전달하면 비용 증가.\n10 document with ChatGPT vs. ES로 정제 후 ChatGPT</p>\n<p>e.g.\nzalando e-commerce app.\n검색, 로깅, ES + ChatGPT 사용하는 중\n사용자 검색 질의 시 계정 정보에 대한 컨텍스트가 있어야 정확한 결과 제공 가능\nv7 -> v8 migrated, knn 검색 사용</p>\n<h2 id=\"engine\" style=\"position:relative;\"><a href=\"#engine\" aria-label=\"engine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Engine</h2>\n<p>Vector engine</p>\n<h1 id=\"es-deep-dive\" style=\"position:relative;\"><a href=\"#es-deep-dive\" aria-label=\"es deep dive permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ES Deep Dive</h1>\n<p>cluster, node, index, shard, segment, document</p>\n<p>apache lucene 자바 라이브러리 사용하여 검색 엔진을 구현함\nSolr도 lucene 사용중.</p>\n<p>eㅐ용량 검색 for clustering</p>\n<p>Cluster 가장 큰 단위\n여러개의 노드를 관리하는 Clustering. node는 여러개의 shard(쓰레드)로 이룸\n무결성, HA를 위한 샤드 recpliation\n복제본은 다른 노드에 위치함\n노드는 java process\n일반적으로 서버 1대당 노드 하나를 설치함. 2개 이상 설치도 가능함</p>\n<p>Discovery: 같은 클러스터에 다른 노드를 찾아 바인딩하는 과정</p>\n<p>ES는 REST API 제공함. Query 등</p>\n<p>document is json format</p>\n<p>검색 엔진은 inverted index 구조로 저장\nterm -> document(id)</p>\n<h2 id=\"텍스트-분석\" style=\"position:relative;\"><a href=\"#%ED%85%8D%EC%8A%A4%ED%8A%B8-%EB%B6%84%EC%84%9D\" aria-label=\"텍스트 분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>텍스트 분석</h2>\n<ul>\n<li>Analyzer라는 도구가 분석함</li>\n<li>character filtering -> tokenizing -></li>\n<li>일반적으로 whitespace tokenizer가 사용됨</li>\n<li>token filtering 대소 변환으로 검색에 유용하게 함, 불용어 제거, 복수형, 동의어 처리(qucik은 fast로도 저장)</li>\n</ul>\n<p>Analyize API\nAPI로 analzyer api 사용 가능</p>\n<p>한글은 사전 기반 분석 필요. 복합어로 이루어짐\n은전한닢 등 한국어 분석기 있음\nES Plugin 형태로 Nori라는 한국어 형태소 분석기가 있음</p>\n<p>match 검색은 텍스트 검색.\nkeyword 필드 검색 시 대소문자까지 구분하여 검색</p>\n<p>Q.</p>\n<ul>\n<li>텍스트 분석 도구 제공한다면.. language aware 한 내용은? => 본문에 나옴</li>\n<li>플러그인 형태로 제공한다는 것은.. 코드 레벨 처리가 불필요?</li>\n</ul>\n<h2 id=\"aggregation\" style=\"position:relative;\"><a href=\"#aggregation\" aria-label=\"aggregation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Aggregation</h2>\n<p>search API에서 검색 count 등</p>\n<p>Units:\nBucket: 일반적으로 집단 기반 구분 (namespace?)\nMetric: min, max, count\nPipeline: 결과에 대한 추가 처리</p>\n<p>위 Unit 별로 Aggregation 가능</p>\n<h2 id=\"색인\" style=\"position:relative;\"><a href=\"#%EC%83%89%EC%9D%B8\" aria-label=\"색인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>색인</h2>\n<p>RR로 도큐먼트들이 각 샤드로 분배됨\nDocument ID를 알고 있으면 검색 없이 조회 가능</p>\n<p>Query Phase</p>\n<ul>\n<li>쿼리는 가장 먼저 모든 샤드에 전달됨.</li>\n<li>각 샤드는 요청만큼 반환함</li>\n<li>클라이언트가 10개 요청하면 모든 샤드에서 각각 10개 조회</li>\n</ul>\n<ol start=\"2\">\n<li>Fetch Phase</li>\n</ol>\n<ul>\n<li>노드가 리턴 결과를 랭킹 점수를 기반으로 정렬하여 반환</li>\n<li>노드가 모든 결과를 정렬하여 10개만 반환</li>\n</ul>\n<p>ES는 랭킹 알고리즘으로 TF/IDF\nES5부터 BM25 알고리즘 사용.\n(<a href=\"https://news.hada.io/topic?id=9034\">https://news.hada.io/topic?id=9034</a> 여기서 본 거 같으니 정리)</p>\n<p>1<del>1000 검색이나 990</del>1000 검색이나 쿼리 처리 규모가 비슷함. 랭킹을 통해 정렬이 필요하므로.</p>\n<h2 id=\"lucene-segment세그먼트\" style=\"position:relative;\"><a href=\"#lucene-segment%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%8A%B8\" aria-label=\"lucene segment세그먼트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lucene Segment(세그먼트)</h2>\n<p>inverted index, doc value, 원본 문서 등 저장</p>\n<p>문서는 inesrt, delete 만 있음. update 없음</p>\n<p>세그먼트 병합을 통해 새로운 세그먼트를 만듦. 비용이 큰 작업이므로 유의.\n오래된 세그먼트는 크고, 최근 것은 상대적으로 작음\n(이걸 정리하는 용도로 병합하나봄)</p>\n<p>세그먼트는 추가, 삭제 과정에서 생성됨\n한 번 생성된 세그먼트는 변경되지 않음(immutable)\n병합을 통해 2개 세그먼트를 합침\n메모리에서 처리 후 flush를 통해 영구 저장됨</p>\n<p>세그먼트의 병합은 자동, 수동으로 할 수 있음</p>\n<p>ES 도입에 대한 워크벤치 도구.</p>\n<h1 id=\"whats-new-in-es-88\" style=\"position:relative;\"><a href=\"#whats-new-in-es-88\" aria-label=\"whats new in es 88 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What's new in ES 8.8</h1>\n<p>Search로는 충분하지 않음. vector search의 필요\nvector search ~= semenatic search</p>\n<p>객체의 비슷함으로 그루핑하여 검색에서 사용함\n이미지, 오디오, 도큐먼트를 모두 Vector화하여 저장함\n조회 시 Vector로 가져와서 처리함\n결과는 도큐먼트를 반환함\nML 모델로 벡터화를 진행함. 대표적인 모델로 BERT를 사용함.</p>\n<p>8.0부터 벡터 저장을 제공함</p>\n<p>검색을 위해서 벡터는 그래프로 저장됨\n전통적인 검색과 벡터 검색을 함께 사용할 수 있다. hybrid scoring이라 함\nbm 25는 전통적인 검색, knn는 벡터 검색을 위해 사용함\nknn: k-neasrt neighbor</p>\n<p>Role 기반으로 민감 데이터를 보호할 수 있음\nthird-party 모델을 ES에서 설정할 수 있다.\n내장 모델이 하나 있음.\nbm25 기반으로 벤치마킹하는데, 내장 모델만으로도 12개의 벤치마크에서 좋다고 판단됨</p>\n<p>더 나은 결과를 위해서 finetuning이 필요한데, 많은 비용이 발생함\n=> finetuning 대신 질의 시 context를 전달하여 정확도를 높이자.\n모든 도큐먼트를 GPT에 전달하지 않고, ES를 사용하여 정제된 context를 결과를 받고 GPT에 전달하여 비용을 줄이자.</p>\n<h2 id=\"logging\" style=\"position:relative;\"><a href=\"#logging\" aria-label=\"logging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Logging</h2>\n<p>ES를 사용하면 증가하는 로그 비용을 줄일 수 있다.</p>\n<p>Elastic Agent로 각종 integration 사용 가능, k8s 연동이라던가, visualizer 라던가..</p>\n<p>Agent에서 로그 검색 기능 제공. AI 기반 검색 가능</p>\n<p>(Agent를 이용해서 저장된 로그를 검색에 대한 내용)</p>\n<p>data tiering. hot, warm cold, frozen 응답에 따라 결정</p>\n<p>cluster cluster search</p>\n<ul>\n<li>분산된 클러스터를 검색할 수 있음</li>\n<li>Google cloud, AWS 나눠서 저장한 경우</li>\n</ul>\n<h1 id=\"\" style=\"position:relative;\"><a href=\"#\" aria-label=\" permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>..</h1>\n<p>Coodinator node?\ndata node와 coordinator node로 구분됨\n대부분 느려지는 문제는 coodinator node만 늘려도 해결되었음</p>\n<p>(<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html\">https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-node.html</a> 더 많은 노드 종류가 있는듯)</p>"}},"pageContext":{"id":"cca85580-c2ba-5449-a508-e2e447c66cc8","fields__slug":"/2023-07-05/","__params":{"fields__slug":"2023-07-05"}}},"staticQueryHashes":[],"slicesMap":{}}